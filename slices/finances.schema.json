{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://life.omni.dev/slices/finances.schema.json",
  "title": "Finances Slice",
  "description": "References to financial accounts and preferences (not balances or transactions)",
  "type": "object",
  "properties": {
    "source": {
      "type": "object",
      "properties": {
        "provider": {
          "type": "string",
          "description": "e.g., 'myfi', 'plaid', 'manual'"
        },
        "userId": { "type": "string" },
        "dashboardUrl": { "type": "string", "format": "uri" },
        "exportUrl": { "type": "string", "format": "uri" },
        "lastSync": { "type": "string", "format": "date-time" }
      },
      "description": "Where full financial data lives"
    },
    "accountRefs": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/accountRef"
      },
      "description": "References to financial accounts (not balances)"
    },
    "preferences": {
      "type": "object",
      "properties": {
        "currency": {
          "type": "string",
          "pattern": "^[A-Z]{3}$",
          "description": "ISO 4217 currency code"
        },
        "budgetCategories": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Custom budget categories"
        },
        "fiscalYearStart": {
          "type": "string",
          "pattern": "^\\d{2}-\\d{2}$",
          "description": "MM-DD"
        }
      }
    }
  },
  "$defs": {
    "accountRef": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string", "description": "User-friendly name" },
        "type": {
          "type": "string",
          "enum": ["checking", "savings", "credit", "investment", "loan", "crypto", "other"]
        },
        "institution": { "type": "string" },
        "lastFour": {
          "type": "string",
          "pattern": "^\\d{4}$",
          "description": "Last 4 digits for identification"
        },
        "isPrimary": { "type": "boolean" }
      },
      "required": ["type"]
    }
  }
}
